# 5-3 클로저 활용 사례

## 5-3-1 콜백 함수 내부에서 외부 데이터를 사용하고자 할 때

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled.png)

코드 4번 줄의 forEach 메소드에 넘긴 콜백 함수 (A)는 내부에서 외부 변수를 참조하지 않아서 클로저가 없지만, addEventListener에 넘겨준 콜백 함수(B)에서는 fruit라는 외부 변수를 참조하므로 클로저가 있다.

→ A가 실행될 때마다 새로운 실행 컨텍스트가 활성화된다. 

코드 7번 줄에서 addEventListener는 외부 함수인 fruit 함수를 참조하고 있으며, fruit함수의 종료 여부와 무관하게 클릭리스너 발생 시 이벤트 리스너의 outerEnvironment가 fruit의 LexicalEnvironment를 참조하게 된다. 

따라서 B가 참조할 예정인 A의 변수 fruit에 대해서는 A 종료 후에도 GC대상에서 제외되어 계속 참조가 가능하다.

**고차함수를 활용한 version**

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%201.png)

alertFruitBulder 함수 내부에서는 실행 결과로 익명 함수를 반환한다. 이 함수가 addEventListener의 콜백 함수로 할당된다. 클릭 이벤트가 발생하면 이 함수의 실행 컨텍스트가 열리면서 인자로 넘어온 fruit를 outerEnvironmentReference에서 참조가 가능하다. 즉 alertFruitBuilder의 실행 결과로 반환된 함수에는 클로저가 존재한다.

## 5-3-2 접근 권한 제어(정보 은닉)

**정보은닉이란?**

어떤 모듈의 내부 로직에 대해 외부로의 노출을 최소화해서 모듈 간의 결합도를 낮추고 유연성을 높이고자 하는 개념

public, private, protected 등의 종류가 있는데, 자바스크립트는 기본적으로 변수 자체에 이러한 접근 권한을 직접 부여하도록 설계되어있지 않다. 하지만 클로저를 이용하면 함수 차원에서 public한 값과 private한 값을 구분할 수 있다.

**정보 은닉을 적용하지 않은 예**

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%202.png)

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%203.png)

기능적으로는 아무 이상이 없으나 외부에서 내부 변수를 마음대로 조작할 수가 있음. 따라서 예제의 객체를 함수화하여 클로저로 보호해야 한다.

**클로저를 활용하여 정보 은닉을 적용한 예**

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%204.png)

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%205.png)

……ㅠ

### 클로저를 활용해 접근권한을 제어하는 방법

1. 외부에 접근 권한을 주고자 하는 대상들로 구성된 참조형 데이터(여럿일 때는 객체 혹은 배열, 하나일 때는 함수)를 return
2.  return한 변수들은 공개 멤버가 되고, 그렇지 않은 변수들은 비공개 멤버가 됨.

## 5-3-3 부분 적용 함수

**부분 적용 함수란?**
n개의 인자를 받는 함수에 미리 a개의 인자만 넘겨 기억시켰다가, 나중에 (n-a)개의 인자를 넘기면 비로소 원래 함수의 실행 결과를 얻을 수 있게끔 하는 함수이다. (ex. bind 메소드)

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%206.png)

여기 예시의 addPartial 함수는 인자 5개를 미리 적용해놓고 추후 인자들을 전달하면 모든 인자들을 모아 원래의 함수가 실행되는 ‘부분 적용 함수’이다

- add 함수는 this를 사용하지 않으므로 bind 메소드만으로는 문제 없이 구현이 되었다. but! this에 관여하지 않는 별도의 부분 적용 함수가 있다면 범용성이 더 뛰어날 것.

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%207.png)

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%208.png)

- 첫번째 인자에는 원본 함수를, 두번쨰 인자 이후부터는 미리 적용할 인자들을 전달하고, 반환할 함수 (부분 적용 함수)에서는 다시 나머지 인자들을 받아 이들을 한데 모아(concat) 원본 함수를 호출(apply)한다.
- 미리 일부 인자를 넘겨두어 기억하게끔 하고 추후 필요한 시점에 기억했던 인자들까지 함께 실행하게 한다.

## 5-3-4 커링 함수

**커링 함수란?**

여러 개의 인자를 받는 함수를 하나의 인자만 받는 함수로 나눠서 순차적으로 호출될 수 있게 체인 형태로 구성한 것

→ 필요한 인자 개수만큼 함수를 만들어 계속 리턴하다가 마지막에 모든 인자를 조합하여 리턴한다.

![필요한 인자 개수만큼 함수를 만들어 계속 리턴](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%209.png)

필요한 인자 개수만큼 함수를 만들어 계속 리턴

부분 적용함수와 기본적인 맥락은 일치

but 차이점은 커링은 한번에 하나의 인자만 전달하는 것을 원칙으로 한다, 중간 과정상의 함수를 실행한 결과는 그 다음 인자를 받기 위해 대기만 할 뿐으로, 마지막 인자가 전달되기 전까지는 원본 함수가 실행되지 않는다.

ES6부터는 화살표를 사용해 가독성을 향상시킴👍

![Untitled](5-3%20%E1%84%8F%E1%85%B3%E1%86%AF%E1%84%85%E1%85%A9%E1%84%8C%E1%85%A5%20%E1%84%92%E1%85%AA%E1%86%AF%E1%84%8B%E1%85%AD%E1%86%BC%20%E1%84%89%E1%85%A1%E1%84%85%E1%85%A8%206a0a8f5e339e4aef8b0f657749d6776e/Untitled%2010.png)